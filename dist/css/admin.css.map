{"version":3,"sources":["webpack:///static/spinningwheel.vue","webpack:///static/admin/app.vue"],"names":[],"mappings":";AAqKA;EACA;AACA;AACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA;;;ACuJA","file":"css/admin.css","sourcesContent":["<!--\nCopyright 2020 Google LLC\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    https://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n-->\n<template>\n  <div class=\"container\" style=\"text-align: center\">\n    <canvas id=\"wheelCanvas\" style=\"width:100%\" @click=\"spin()\" width=\"700\" height=\"700\">\n    </canvas>\n    <div v-if=\"!isTouchScreen\" id=\"instructionsLayer\" ref=\"instructionsLayer\" @click=\"spin()\">\n      <div class=\"instructionsText\" id=\"topInstruction\" style=\"padding-top: 20%\">\n        {{ $t('spinningwheel.Click to spin') }}\n      </div>\n      <div class=\"instructionsText\" id=\"bottomInstruction\" style=\"padding-top: 60%\">\n        {{ $t('spinningwheel.or press ctrl+enter') }}\n      </div>\n    </div>\n    <div v-if=\"isTouchScreen\" id=\"instructionsLayer\" ref=\"instructionsLayer\" @click=\"spin()\">\n      <div class=\"instructionsText\" id=\"topInstruction\" style=\"padding-top: 20%\">\n        {{ $t('spinningwheel.Tap to spin') }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import Wheel from './Wheel.js';\n  import * as Util from './Util.js';\n  import Ticker from './Ticker.js';\n  import CircleType from 'circletype';\n  import * as Locales from './Locales.js';\n\n  export default {\n    data() {\n      return {\n        myWheel: new Wheel(), myTicker: new Ticker(),\n        isTouchScreen: Util.isTouchScreen()\n      }\n    },\n    mounted() {\n      this.myWheel = new Wheel();\n      this.tick(0);\n      this.setupOverlay();\n      this.startKeyListener();\n    },\n    computed: {\n      wheelConfig() {\n        return this.$store.state.wheelConfig;\n      },\n      names() {\n        return this.$store.state.wheelConfig.names;\n      },\n      preferences() {\n        return this.$store.state.preferences\n      },\n      hasEntries() {\n        return (this.$store.state.wheelConfig.names.length>0);\n      }\n    },\n    watch: {\n      wheelConfig(newValue, oldValue) {\n        this.configureWheel();\n      },\n      preferences(newValue) {\n        this.configureWheel();\n      },\n      names(newValue, oldValue) {\n        this.myWheel.setNames(newValue, this.wheelConfig.maxNames,\n                              this.wheelConfig.allowDuplicates);\n      },\n    },\n    methods: {\n      setupOverlay() {\n        const side = document.getElementById('wheelCanvas').offsetWidth;\n        const fontSize = `${Math.round(side/20)}px`;\n        document.getElementById('instructionsLayer').style.fontSize = fontSize;\n        if (this.cantBeDisplayedInCircleType(this.$i18n.locale)) return;\n        const radius = side / 3;\n        new CircleType(document.getElementById('topInstruction'))\n          .radius(radius);\n        if (document.getElementById('bottomInstruction')) {\n          new CircleType(document.getElementById('bottomInstruction'))\n            .radius(radius).dir(-1);\n        }\n      },\n      cantBeDisplayedInCircleType(locale) {\n        return ['ar', 'bn', 'fa', 'gu', 'he', 'hi'].includes(locale);\n      },\n      startKeyListener() {\n        if (!Util.isTouchScreen()) {\n          const self = this;\n          document.addEventListener('keyup', event => {\n            if (event.key == 'Enter' && event.ctrlKey) {\n              self.spin();\n            }\n          });\n        }\n      },\n      spin() {\n        if (this.myWheel.isSpinning()) return;\n        if (!this.hasEntries) return;\n        this.trackInGoogleAnalytics();\n        this.$refs.instructionsLayer.style.display = 'none';\n        this.$store.commit('startWheelSpin');\n        this.$emit('wheel-started');\n        this.myWheel.click(this.onNameChanged, this.onStopWheelSpin);\n      },\n      onNameChanged() {\n        this.$emit('name-changed');\n      },\n      onStopWheelSpin(winningEntry) {\n        this.$store.commit('stopWheelSpin');\n        this.$emit('wheel-stopped', winningEntry);\n      },\n      trackInGoogleAnalytics() {\n        const defaultNames = this.wheelConfig.getDefaultNames();\n        if (!Util.arraysEqual(this.names, defaultNames)) {\n          const label = this.$store.state.version;\n          Util.trackEvent('Wheel', 'SpinWithCustomNames', label);\n        }\n        else {\n          Util.trackEvent('Wheel', 'SpinWithDefaultNames', '');\n        }\n      },\n      tick(ms) {\n        this.myTicker.setTimestamp(ms);\n        while (this.myTicker.shouldTick()) {\n          this.myWheel.tick();\n        }\n        const context = document.getElementById('wheelCanvas').getContext('2d');\n        this.myWheel.draw(context);\n        requestAnimationFrame(this.tick);\n      },\n      resetRotation() {\n        this.myWheel.resetRotation();\n      },\n      refresh() {\n        this.myWheel.refresh();\n      },\n      configureWheel() {\n        this.myWheel.configure(\n          this.$store.state.wheelConfig.getCoalescedColors(),\n          this.$store.state.wheelConfig.getWheelImage(),\n          this.$store.state.wheelConfig.spinTime,\n          this.$store.state.wheelConfig.slowSpin,\n          this.$store.state.wheelConfig.hubSize,\n          this.$store.getters.darkMode ? \n            '#000' : this.$store.state.wheelConfig.pageBackgroundColor\n        );\n      },\n    }\n  }\n</script>\n\n<style scoped>\n  .container {\n    position: relative;\n  }\n  .instructionsText {\n    width: 100%;\n    height: 100%;            \n    position: absolute;\n    top: 0;\n    left: 0;\n    color: #FFF;\n    text-shadow: 0px 0px 10px #000000;\n    background-color: #00000000;\n    font-family: sans-serif;\n    font-weight: 800;\n  }\n</style>\n","<!--\nCopyright 2020 Google LLC\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    https://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n-->\n<template>\n  <span>\n    <admintoolbar\n      v-on:log-in=\"logIn\"\n      v-on:log-out=\"logOut\"\n      v-on:open-users-dialog=\"openUsersDialog()\"\n      v-on:open-payments-dialog=\"openPaymentsDialog()\"\n      v-on:open-dirtywords-dialog=\"openDirtyWordsDialog()\"\n    ></admintoolbar>\n    <section class=\"section\" style=\"padding-top:1rem; padding-bottom:0; font-family:Quicksand\">\n      <div class=\"columns\">\n        <div class=\"column is-6\">\n          <spinningwheel ref=\"spinningwheel\"\n          ></spinningwheel>\n        </div>\n        <div class=\"column is-3\">\n          <textbox></textbox>\n        </div>\n        <div class=\"column is-3\">\n          <b-field label=\"Shared wheel link\">\n            <b-input v-model=\"linkInTextBox\"></b-input>\n          </b-field>\n          <b-button type=\"is-info\" @click=\"loadSharedWheel\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"far fa-folder-open\"></i> Open\n          </b-button>\n          <b-button type=\"is-info\" @click=\"loadNextSharedWheel\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"fas fa-chevron-circle-right\"></i> Open next\n            <span style=\"font-size:0.7em\">(Ctrl N)</span>\n          </b-button>\n          <br><br>\n          <b-button @click=\"translateSharedWheel\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"fas fa-globe-americas\"></i> Translate\n            <span style=\"font-size:0.7em\">(Ctrl T)</span>\n          </b-button>\n          <b-button @click=\"searchFacebook\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"fab fa-facebook-square\"></i> Search\n          </b-button>\n          <br><br>\n          <b-button type=\"is-success\" @click=\"approveWheel\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"far fa-thumbs-up\"></i> Approve\n            <span style=\"font-size:0.7em\">(Ctrl A)</span>\n          </b-button>\n          <b-button type=\"is-danger\" @click=\"deleteWheel\" :disabled=\"!userIsLoggedIn\">\n            <i class=\"fas fa-trash-alt\"></i> Delete\n          </b-button>\n          <br><br>\n          <table class=\"table is-bordered can-go-dark\">\n            <tr>\n              <td><b>Wheels in queue</b></td>\n              <td colspan=\"2\"><span class=\"is-pulled-right\"><b>\n                {{ $store.state.reviewQueueLength | localestring }}\n              </b></span></td>\n            </tr>\n            <tr>\n              <td>Reviewed by me</td>\n              <td>\n                <span class=\"is-pulled-right\">\n                  <b-tooltip label=\"How many wheels you have reviewed in this session\" position=\"is-left\">\n                    {{ user.sessionReviews }}\n                  </b-tooltip>\n                </span>\n              </td>\n              <td><span class=\"is-pulled-right\">\n                <b-tooltip label=\"How many wheels you have reviewed since the last payment\" position=\"is-left\">\n                  {{ user.totalReviews }}\n                </b-tooltip>\n              </span></td>\n            </tr>\n            <tr>\n              <td>Earnings</td>\n              <td>\n                <b-tooltip label=\"How much you have earned in this session\" position=\"is-left\">\n                  {{ user.sessionReviews * earningsPerReview | dollaramount }}\n                </b-tooltip>\n              </td>\n              <td>\n                <b-tooltip label=\"How much you have earned since the last payment\" position=\"is-left\">\n                  {{ user.totalReviews * earningsPerReview | dollaramount }}\n                </b-tooltip>\n              </td>\n            </tr>\n          </table>\n          <table class=\"table is-bordered can-go-dark\">\n            <tr>\n              <td><b>Status</b></td>\n              <td><b>{{ wheel.reviewStatus }}</b></td>\n            </tr>\n            <tr>\n              <td>Created</td>\n              <td>{{ wheel.created | firestoremilliseconds | timeago }}</td>\n            </tr>\n            <tr>\n              <td>Last viewed</td>\n              <td>{{ wheel.lastRead | firestoremilliseconds | timeago }}</td>\n            </tr>\n            <tr>\n              <td>Views</td>\n              <td>{{ wheel.readCount | localestring }}</td>\n            </tr>\n            <tr>\n              <td><i class=\"far fa-thumbs-up\"></i> prediction</td>\n              <td>{{ wheel.predictedApproval | percent }}</td>\n            </tr>\n          </table>\n        </div>\n      </div>\n    </section>\n\n    <usersdialog ref=\"usersdialog\"/>\n    <paymentsdialog ref=\"paymentsdialog\"/>\n    <dirtywordsdialog ref=\"dirtywordsdialog\"/>\n  </span>\n</template>\n\n<script>\n  import admintoolbar from './admintoolbar.vue';\n  import spinningwheel from '../spinningwheel.vue';\n  import textbox from './textbox.vue';\n  import usersdialog from './usersdialog.vue';\n  import paymentsdialog from './paymentsdialog.vue';\n  import dirtywordsdialog from './dirtywordsdialog.vue';\n  import * as Util from '../Util.js';\n  import * as Firebase from '../Firebase.js';\n  import { timeago, dollaramount, firestoremilliseconds, localestring, percent } from './filters.js';\n\n  export default {\n    components: {\n      admintoolbar, spinningwheel, textbox, usersdialog, paymentsdialog,\n      dirtywordsdialog\n    },\n    filters: {\n      timeago, dollaramount, firestoremilliseconds, localestring, percent\n    },\n    data() {\n      return {\n        linkInTextBox: '', waitAnimation: ''\n      };\n    },\n    computed: {\n      wheel() {\n        return this.$store.state.wheel;\n      },\n      earningsPerReview() {\n        return this.$store.state.earningsPerReviewDoc.value;\n      },\n      user() {\n        return this.$store.state.user;\n      },\n      darkMode() {\n        return this.$store.getters.darkMode;\n      },\n      userIsLoggedIn() {\n        return this.$store.state.appStatus.userIsLoggedIn;\n      },\n      preferences() {\n        return this.$store.state.preferences;\n      },\n      darkMode() {\n        return this.$store.getters.darkMode\n      },\n      pageColor() {\n        return this.$store.state.wheelConfig.pageBackgroundColor\n      }\n    },\n    watch: {\n      wheelConfig() {\n        Util.updateColorStyles(this.darkMode, '#000', this.pageColor);\n      },\n      preferences() {\n        Util.updateColorStyles(this.darkMode, '#000', this.pageColor);\n      },\n    },\n    mounted() {\n      this.refreshWheelOnFontLoad();\n      Firebase.loadLibraries();\n      const self = this;\n      document.addEventListener('keyup', event => {\n        if (event.ctrlKey) {\n          if (event.key == 'n') self.loadNextSharedWheel();\n          if (event.key == 'a') self.approveWheel();\n          if (event.key == 't') self.translateSharedWheel();\n        }\n      });\n    },\n    methods: {\n      async logIn() {\n        const user = await Firebase.logIn('Google', 'en');\n        this.$store.dispatch('bindFirestore');\n        const idToken = await user.getIdToken();\n        this.$store.commit('logInUser', {\n          photoUrl: user.photoURL, displayName: user.displayName, uid: user.uid,\n          idToken: idToken\n        });\n        this.$store.dispatch('bindUser', user.uid);\n        this.$store.dispatch('resetSessionReviews', user.uid);\n        const self = this;\n        setInterval(async () => {\n          // Refresh ID token.\n          const idToken = await user.getIdToken(true);\n          self.$store.commit('logInUser', {\n            photoUrl: user.photoURL, displayName: user.displayName, uid: user.uid,\n            idToken: idToken\n          });\n        }, 1000*60*55);\n        setInterval(async () => {\n          self.$store.dispatch('updateReviewQueueLength');\n        }, 1000*60);\n        this.$store.dispatch('updateReviewQueueLength');\n      },\n      logOut() {\n        Firebase.logOut();\n        this.$store.commit('logOutUser');\n      },\n      refreshWheelOnFontLoad() {\n        if (document.fonts) {\n          const self = this;\n          document.fonts.ready.then(function() {\n            self.$refs.spinningwheel.refresh();\n          })\n        }\n      },\n      async loadSharedWheel() {\n        const match = this.linkInTextBox.match(/(\\w\\w\\w\\-\\w\\w\\w)/);\n        if (match) {\n          const path = match[1];\n          try {\n            this.startWaitAnimation();\n            await this.$store.dispatch('loadWheel', path);\n          }\n          catch (ex) {\n            alert(ex);\n          }\n          this.stopWaitAnimation();\n        }\n      },\n      async loadNextSharedWheel() {\n        try {\n          this.startWaitAnimation();\n          await this.$store.dispatch('getNextSharedWheelForReview');\n          this.linkInTextBox = this.wheel.path || '';\n        }\n        catch (ex) {\n          alert(ex);\n        }\n        this.stopWaitAnimation();\n      },\n      async translateSharedWheel() {\n        if (!this.wheel.path) return;\n        try {\n          this.startWaitAnimation();\n          await this.$store.dispatch('translateWheel');\n        }\n        catch (ex) {\n          alert(ex);\n        }\n        this.stopWaitAnimation();\n      },\n      searchFacebook() {\n        const searchTerm = 'wheelofnames ' + this.wheel.path;\n        window.open('https://www.facebook.com/search/top/?q=' + searchTerm);\n      },\n      async approveWheel() {\n        if (!this.wheel.path) return;\n        try {\n          this.startWaitAnimation();\n          await this.$store.dispatch('approveWheel');\n        }\n        catch(ex) {\n          alert(ex);\n        }\n        this.stopWaitAnimation();\n      },\n      async deleteWheel() {\n        if (!this.wheel.path) return;\n        if (confirm('Are you sure you want to delete this wheel?')) {\n          try {\n            this.startWaitAnimation();\n            await this.$store.dispatch('deleteWheel');\n            this.linkInTextBox = '';\n          }\n          catch(ex) {\n            alert(ex);\n          }\n          this.stopWaitAnimation();\n        }\n      },\n      startWaitAnimation() {\n        this.waitAnimation = this.$buefy.loading.open({container: null});\n      },\n      stopWaitAnimation() {\n        this.waitAnimation.close();\n      },\n      openUsersDialog() {\n        this.$refs.usersdialog.show();\n      },\n      openPaymentsDialog() {\n        this.$refs.paymentsdialog.show();\n      },\n      openDirtyWordsDialog() {\n        this.$refs.dirtywordsdialog.show();\n      },\n      getElementsByClassName(classNames) {\n        const retVal = [];\n        for (const className of classNames) {\n          for (const el of document.getElementsByClassName(className)) {\n            retVal.push(el);\n          }\n        }\n        return retVal;\n      }\n    }\n  }\n</script>\n\n<style>\n  .can-go-dark {}\n</style>\n"],"sourceRoot":""}